(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[812],{6593:function(e,t,n){"use strict";n.d(t,{Z:function(){return f}});var o=n(7294),r=n(8375);function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var f=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(m,e);var t,n,c,f,p=(c=m,f=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=i(c);if(f){var n=i(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return u(this,e)});function m(){var e,t;a(this,m);for(var n=arguments.length,c=new Array(n),l=0;l<n;l++)c[l]=arguments[l];return u(t,(e=t=p.call.apply(p,[this].concat(c)),t.state={showAlert:!1,timeout:5e3},t.getReactAlerts=function(e){return e?e.map((function(e,t){var n="success"===e.type?"primary":"danger";return o.createElement(r.Z,{variant:n,key:t},e.message)})):o.createElement(o.Fragment,null)},t.delay=function(e){return new Promise((function(t,n){setTimeout((function(){return t()}),e)}))},t.showAlert=function(){return t.state.showAlert?(t.delay(t.props.timeout?t.props.timeout:t.state.timeout).then((function(e){return t.setState({showAlert:!1})})),o.createElement(o.Fragment,null,t.getReactAlerts(t.props.messages))):o.createElement("div",null)},e))}return t=m,(n=[{key:"componentDidUpdate",value:function(e,t){var n=!1,o=this.props.messages,r=e.messages;o&&o.length>0&&o!==r&&(n=!0),n&&!this.state.showAlert&&this.setState({showAlert:n})}},{key:"render",value:function(){return o.createElement(o.Fragment,null,this.showAlert())}}])&&l(t.prototype,n),m}(o.Component)},812:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return v}});var o=n(7294),r=n(4479),c=n(2151),a=n(4051),l=n(5005),s=n(6593);function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){p(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function b(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?h(e):t}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var v=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}(v,e);var t,n,u,i,p=(u=v,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=w(u);if(i){var n=w(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return d(this,e)});function v(){var e,t;m(this,v);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return d(t,(e=t=p.call.apply(p,[this].concat(o)),t.state={messages:[],uploadFile:null,clearDB:!1,websocket:{ws:null,status:"disconnected"},downloadFormat:"json"},t.downloadUrl="/testforjob/api/download/",t.uploadUrl="/testforjob/ws/upload/",t.getDownloadUrl=function(){return"/testforjob/api/download_".concat(t.state.downloadFormat,"/")},t.setWebsocketStatus=function(e){var n=f(f({},t.state.websocket),{},{status:e});t.setState({websocket:n})},t.checkWebsocket=function(){var e=t.state.websocket.ws;e&&e.readyState!==WebSocket.CLOSED||t.connectWebsocket()},t.connectWebsocket=function(){var e,n=h(t),o="https:"===window.location.protocol?"wss":"ws",r="".concat(o,"://").concat(window.location.host).concat(t.uploadUrl),c=new WebSocket(r);c.onopen=function(){n.timeout=250,clearTimeout(e),t.setWebsocketStatus("connected to ".concat(r))},c.onmessage=function(e){var n=JSON.parse(e.data);t.setState({messages:n?[n]:[]})},c.onclose=function(){t.setWebsocketStatus("disconnected"),n.timeout=n.timeout+n.timeout,e=setTimeout(t.checkWebsocket,Math.min(1e4,n.timeout))},c.onerror=function(e){console.log("websocket error",e),t.setWebsocketStatus("websocket error: ".concat(e))};var a=f(f({},t.state.websocket),{},{ws:c});t.setState({websocket:a})},t.selectFormat=function(e){t.setState({downloadFormat:e.target.value})},t.selectFileToUpload=function(e){var n=document.createElement("input");n.type="file",n.onchange=function(e){var n=e.target.files[0];t.setState({uploadFile:n})},n.click()},t.sendFile=function(e){var n=new FileReader;n.readAsText(t.state.uploadFile,"UTF-8"),n.onload=function(e){var n=e.target.result;t.state.websocket.ws.send(JSON.stringify({cleardb:t.state.clearDB,content:n}))}},t.clearDB=function(){var e=!t.state.clearDB;t.setState({clearDB:e})},e))}return t=v,(n=[{key:"componentDidMount",value:function(){this.connectWebsocket()}},{key:"render",value:function(){return o.createElement("div",null,o.createElement(s.Z,{messages:this.state.messages}),o.createElement(r.Z,null,o.createElement(r.Z.Header,null,o.createElement(c.Z.Label,{className:"col-5"},"Загрузка в DB"),o.createElement("div",{className:"col-12 text-left"},"Websocket status: ",this.state.websocket.status)),o.createElement(r.Z.Body,null,o.createElement(a.Z,null,o.createElement(c.Z.Label,{className:"col-2 text-left"},"Очистить DB"),o.createElement(c.Z.Check,{name:"clearBD",value:this.state.clearDB,onChange:this.clearDB,className:"ml-2"})),o.createElement(a.Z,null,o.createElement(c.Z.Label,{className:"col-2 text-left"},"Файл загрузки в DB"),o.createElement("input",{className:"form-control col-3",name:"uploadFileName",id:"uploadFileName",type:"text",value:this.state.uploadFile?this.state.uploadFile.name:"",readOnly:!0}),o.createElement(l.Z,{variant:"primary",className:"",onClick:this.selectFileToUpload},"..."),o.createElement(l.Z,{variant:"primary",className:"col-1 ml-2",onClick:this.sendFile,disabled:this.state.uploadFile?"":"disabled"},"Старт")))),o.createElement("hr",null),o.createElement(r.Z,null,o.createElement(r.Z.Header,null,o.createElement(c.Z.Label,{className:"col-5"},"Выгрузка DB")),o.createElement(r.Z.Body,null,o.createElement(a.Z,null,o.createElement(c.Z.Label,{className:"col-3 text-left"},"Выберите формат сохраняемого файла"),o.createElement(c.Z.Control,{as:"select",className:"col-2",onChange:this.selectFormat},o.createElement("option",{value:"json"},"json"),o.createElement("option",{value:"csv"},"csv"),o.createElement("option",{value:"text"},"text/plain")),o.createElement("form",{action:this.getDownloadUrl(),method:"post"},o.createElement(l.Z,{variant:"primary",type:"submit",className:"col ml-4"},"Старт"))))))}}])&&b(t.prototype,n),v}(o.Component)}}]);
//# sourceMappingURL=812.js.map